<h2>Heap</h2>
<html><body><p>This topic is dedicated to one of the fundamental ideas concerning the memory used by the application: we'll talk about <strong>heap</strong>. You will find out what its role is, what is stored there, and how the application data gets there.</p>
<h5 id="the-heap">The heap</h5>
<p>The heap space is a special section of memory located in <strong>Random Access Memory</strong>, where the application stores objects created during the execution. It is closely related to stack since objects are referred from the heap using variables from the stack that store a reference to the object. </p>
<p>Let's see an example of how it works. Take a look at the following code: <code class="java">Object obj = new Object()</code>. In the left part, we declared a variable of type <code class="java">Object</code> that is stored in the stack. In the right part, two operations are performed. First, the <code class="java">new</code> operator dynamically allocates memory space for the object which will be created and attached to the appropriate variable in the stack. Then the constructor initializes the object, that is, it assigns initial values to the object fields. <br/>
</p><div class="alert alert-primary">Speaking of dynamic memory allocation, it is important to understand that the developer doesn't have to think about when and how much memory to allocate for an object. This is done automatically when the application is executed. </div><br/>
If we assume that in our example the object was created at the address <code class="java">0x001</code>, then we will have this structure inside the memory:<p></p>
<p style="text-align: center;"><img alt="" height="409" name="2.svg" src="https://ucarecdn.com/52a6361b-02cc-4e8d-b27a-552f168bedaf/" width="585"/></p>
<p>Note that each object doesn't need to be directly associated with a variable from the stack. We'll talk about it in detail in the next section.</p>
<h5 id="heap-structure">Heap structure</h5>
<p>The heap area is created when the program starts. In the heap, objects are created and deleted automatically. Unlike a stack, where data is stored sequentially, an object inside a heap can be single or reference other objects.<br/>
In the previous section, we mentioned that an object is not always directly connected to a stack variable. Here is an example of a situation where you will see the internal structure of the heap:</p>
<p style="text-align: center;"><img alt="" height="457" name="1.svg" src="https://ucarecdn.com/eb7242a3-979f-4181-b574-6aff4bb61d98/" width="585"/></p>
<p>In the image above, only object <code class="java">0x001</code> is associated with the <code class="java">obj_1</code> variable. The other objects are connected to it via object <code class="java">0x001</code>. On the other hand, object <code class="java">0x005</code> was associated with the variable <code class="java">obj_2</code>, but at some point in the execution of the program, their relationship was removed. Now this object is unused and available for deletion by the JVM.<br/>
Before Java 8, a heap space had a special separate section called a <strong>Permanent Generation </strong>(PermGen) which stored loaded class metadata, String Pool objects (up to the seventh version of Java), and some other stuff. Since Java 8 it has been replaced by the <strong>Metaspace </strong>which isn't part of a heap and, unlike the PermGen, can increase its size automatically.   </p>
<h5 id="heap-settings">Heap settings</h5>
<p>Of course, memory management in Java or Kotlin is done automatically, but the <strong>HotSpot JVM</strong> provides us with some settings for heap management. Here are just a few of them:</p>
<ul>
<li><strong>-Xms </strong>for setting the initial heap size when the JVM starts. The full structure for this command is <strong>-Xms+size</strong>. For instance, if you want to set it equal to 10MB the full command is <strong>-Xms10m </strong>or <strong>-Xms10240k</strong>.</li>
<li><strong>-Xmx </strong>for setting the maximum heap size. It is configured in the same way as the previous command. If you want to set it to 1GB the full command is <strong>-Xmx1g </strong>or<strong> -Xmx1024m</strong>.</li>
<li><strong>-XX:PermSize </strong>for setting the initial size of the Permanent Generation. The full command for setting this option equal to 10MB looks like this: <strong>-XX:PermSize=10m </strong>or<strong> -XX:PermSize=10240k</strong>.</li>
<li><strong>-XX:MaxPermSize </strong>for setting the maximum size of the Permanent Generation. If you want to set it to 1GB the full command will be <strong>-XX:MaxPermSize=1g </strong>or if you use megabytes unit it will be<strong> </strong><strong>-XX:MaxPermSize=1024m</strong>.</li>
</ul>
<p>It is preferable to limit the maximum size of the heap. This will help reduce the impact of memory leaks on other processes in the operating system. Otherwise, the OS memory may be overused due to the work of your application and other processes will also lack memory.<br/>
</p><div class="alert alert-primary">Memory leaks occur when, due to incorrect memory management, unnecessary objects aren't deleted or become unreachable for some reason. In such situations, the memory allocated for the application is consumed faster. When the heap runs out of free memory and there isn't enough space to allocate new objects, the application will throw the <code class="java">OutOfMemoryError</code>.</div><br/>
In this section, we mentioned just a few basic settings you can use to manage the heap size in your application. JVM has dozens of them, each providing a specific setting option for other purposes.<p></p>
<h5 id="conclusion">Conclusion</h5>
<p>In this topic, you learned some essential information about heap space and its management options. Understanding the process of memory management is a key skill for every Java or Kotlin programmer: during their work, developers often need to optimize the application performance. That's why it's so important to know how the heap memory operates.</p></body></html>
